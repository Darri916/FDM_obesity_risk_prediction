<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Obesity Risk Prediction System - Commercial</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            text-align: center;
        }

        .stat-card .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-card .stat-label {
            color: #666;
            font-size: 0.9em;
        }

        .main-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            margin-bottom: 20px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            padding: 15px 30px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.1em;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            font-weight: 600;
        }

        .tab:hover {
            color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 0.95em;
        }

        .form-group input,
        .form-group select {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .info-text {
            color: #666;
            font-size: 0.85em;
            margin-top: 4px;
        }

        .btn {
            padding: 15px 40px;
            font-size: 1.1em;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 100%;
            margin-top: 20px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #2ecc71;
            color: white;
            width: 100%;
            margin-top: 10px;
        }

        .btn-secondary:hover {
            background: #27ae60;
            transform: translateY(-2px);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .result-section {
            display: none;
            margin-top: 30px;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .result-header {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .result-icon {
            font-size: 4em;
            margin-bottom: 10px;
        }

        .result-class {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }

        .result-confidence {
            font-size: 1.1em;
            color: #666;
            margin: 5px 0;
        }

        .risk-badge {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 20px;
            color: white;
            font-weight: 600;
            margin: 10px 0;
        }

        .probability-bars {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .probability-bars h3 {
            margin-bottom: 20px;
            color: #333;
        }

        .prob-item {
            margin-bottom: 15px;
        }

        .prob-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-weight: 600;
            font-size: 0.9em;
        }

        .prob-bar {
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
        }

        .prob-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 1s ease;
            display: flex;
            align-items: center;
            padding-left: 15px;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
        }

        .recommendations-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .recommendations-section h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.4em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .recommendation-category {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            border-radius: 8px;
        }

        .recommendation-category .category-title {
            font-weight: 700;
            color: #667eea;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .recommendation-category .advice-text {
            color: #555;
            line-height: 1.6;
        }

        .general-recommendations {
            list-style: none;
        }

        .general-recommendations li {
            padding: 12px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: start;
        }

        .general-recommendations li:last-child {
            border-bottom: none;
        }

        .general-recommendations li:before {
            content: "✓";
            color: #2ecc71;
            font-weight: bold;
            margin-right: 12px;
            font-size: 1.3em;
        }

        .upload-area {
            border: 2px dashed #667eea;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            background: #f8f9ff;
            cursor: pointer;
            transition: all 0.3s;
        }

        .upload-area:hover {
            background: #e8ebff;
            border-color: #764ba2;
        }

        .upload-area.dragover {
            background: #d4d9ff;
            border-color: #764ba2;
        }

        .batch-results {
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
        }

        .batch-result-item {
            padding: 10px;
            margin: 5px 0;
            background: #f9f9f9;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .batch-result-item.success {
            border-left: 4px solid #2ecc71;
        }

        .batch-result-item.failed {
            border-left: 4px solid #e74c3c;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .main-card {
                padding: 20px;
            }

            .stats-bar {
                grid-template-columns: 1fr;
            }
        }

       .chat-message {
    margin: 20px 0;
    padding: 15px 20px;
    border-radius: 18px;
    max-width: 85%;
    animation: slideIn 0.4s ease;
    box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    line-height: 1.6;
    font-size: 0.98em;
}

.chat-message.assistant {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    margin-right: auto;
    border-bottom-left-radius: 5px;
    position: relative;
}

.chat-message.assistant::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: -8px;
    width: 0;
    height: 0;
    border-style: solid;
    border-width: 0 0 20px 8px;
    border-color: transparent transparent #764ba2 transparent;
}

.chat-message.user {
    background: #ffffff;
    color: #333;
    margin-left: auto;
    border-bottom-right-radius: 5px;
    text-align: right;
    border: 2px solid #e8e8e8;
    position: relative;
}

.chat-message.user::after {
    content: '';
    position: absolute;
    bottom: 0;
    right: -8px;
    width: 0;
    height: 0;
    border-style: solid;
    border-width: 0 8px 20px 0;
    border-color: transparent transparent #ffffff transparent;
}

.chat-message.assistant::before {
    content: "🤖 AI";
    font-size: 0.85em;
    opacity: 0.9;
    display: block;
    margin-bottom: 5px;
    font-weight: 600;
}

.chat-message.user::before {
    content: "You 👤";
    font-size: 0.85em;
    opacity: 0.7;
    display: block;
    margin-bottom: 5px;
    font-weight: 600;
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateY(15px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.typing-indicator {
    display: inline-block;
    padding: 12px 18px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 18px;
    margin: 15px 0;
    box-shadow: 0 2px 10px rgba(102, 126, 234, 0.3);
}

.typing-indicator span {
    height: 10px;
    width: 10px;
    background: white;
    display: inline-block;
    border-radius: 50%;
    margin: 0 3px;
    animation: typing 1.4s infinite;
}

.typing-indicator span:nth-child(2) {
    animation-delay: 0.2s;
}

.typing-indicator span:nth-child(3) {
    animation-delay: 0.4s;
}

@keyframes typing {
    0%, 60%, 100% {
        transform: translateY(0);
        opacity: 0.5;
    }
    30% {
        transform: translateY(-12px);
        opacity: 1;
    }
}

.quick-reply-btn {
    display: inline-block;
    padding: 10px 20px;
    margin: 5px;
    background: white;
    color: #667eea;
    border: 2px solid #667eea;
    border-radius: 25px;
    cursor: pointer;
    transition: all 0.3s;
    font-weight: 500;
    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
}

.quick-reply-btn:hover {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
}

.progress-indicator {
    background: #f0f0f0;
    height: 8px;
    border-radius: 10px;
    margin: 15px 0;
    overflow: hidden;
}

.progress-bar {
    height: 100%;
    background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    transition: width 0.5s ease;
    border-radius: 10px;
}

.result-card-chat {
    background: white;
    border-radius: 15px;
    padding: 20px;
    margin: 15px 0;
    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    border-left: 5px solid #667eea;
}

.result-card-chat h4 {
    color: #667eea;
    margin-bottom: 10px;
    font-size: 1.2em;
}

.confidence-bar-chat {
    background: #e0e0e0;
    height: 30px;
    border-radius: 15px;
    overflow: hidden;
    margin: 10px 0;
    position: relative;
}

.confidence-fill-chat {
    height: 100%;
    background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    display: flex;
    align-items: center;
    padding-left: 15px;
    color: white;
    font-weight: bold;
    transition: width 1s ease;
}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🏥 Obesity Risk Prediction System</h1>
            <p>AI-Powered Commercial Health Assessment Platform</p>
        </div>

        <!-- Statistics Bar -->
        <div class="stats-bar" id="statsBar">
            <div class="stat-card">
                <div class="stat-number" id="totalPredictions">-</div>
                <div class="stat-label">Total Predictions</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="avgConfidence">-</div>
                <div class="stat-label">Avg Confidence</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="avgBMI">-</div>
                <div class="stat-label">Average BMI</div>
            </div>
        </div>

        <div class="main-card">
            <!-- Tabs -->
            <div class="tabs">
                <button class="tab active" onclick="showTab('single')">🔍 Single Prediction</button>
                <button class="tab" onclick="showTab('batch')">📊 Batch Upload</button>
                <button class="tab" onclick="showTab('stats')">📈 Statistics</button>
                <button class="tab" onclick="showTab('assistant')">🤖 AI Health Assistant</button>
            </div>
           <!-- AI Health Assistant Tab -->
<div id="assistantTab" class="tab-content">
    <h2 style="margin-bottom: 25px; color: #333;">AI Health Assistant - Conversational Assessment</h2>
    
    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);">
        <h3 style="margin: 0 0 10px 0; font-size: 1.5em;">👋 Welcome to Your Personal Health Assistant</h3>
        <p style="margin: 0; opacity: 0.95; font-size: 1.05em; line-height: 1.6;">I'll guide you through a friendly conversation to assess your obesity risk. Just answer my questions naturally, and I'll provide personalized insights along the way!</p>
    </div>

    <div class="recommendations-section" style="max-height: 550px; overflow-y: auto; background: #f8f9fa; padding: 25px; border-radius: 15px; box-shadow: inset 0 2px 10px rgba(0,0,0,0.05);" id="chatContainer">
        <div id="chatMessages"></div>
    </div>

    <div style="display: flex; gap: 10px; margin-top: 15px; align-items: center;">
        <input type="text" id="userInput" placeholder="Type your answer here..." 
               style="flex: 1; padding: 15px 20px; border: 2px solid #e0e0e0; border-radius: 25px; font-size: 1em; transition: all 0.3s;"
               onkeypress="if(event.key==='Enter') sendMessage()"
               onfocus="this.style.borderColor='#667eea'; this.style.boxShadow='0 0 0 3px rgba(102, 126, 234, 0.1)'"
               onblur="this.style.borderColor='#e0e0e0'; this.style.boxShadow='none'">
        <button onclick="sendMessage()" class="btn btn-primary" style="width: auto; margin: 0; padding: 15px 35px; border-radius: 25px;">
            Send 📤
        </button>
    </div>
    
    <div style="margin-top: 15px; display: flex; gap: 10px;">
        <button onclick="startAssistant()" class="btn btn-secondary" style="width: auto; margin: 0; flex: 1; border-radius: 10px;">
            🔄 Start New Assessment
        </button>
        <button onclick="skipToForm()" class="btn" style="width: auto; margin: 0; flex: 1; background: #95a5a6; color: white; border-radius: 10px;">
            ⚡ Skip to Quick Form
        </button>
    </div>
    
    <!-- Hidden detailed results section -->
    <div id="assistantDetailedResults" style="display: none; margin-top: 25px;"></div>
</div>

            <!-- Single Prediction Tab -->
            <div id="singleTab" class="tab-content active">
                <h2 style="margin-bottom: 25px; color: #333;">Enter Your Health Information</h2>
                
                <form id="predictionForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="Gender">Gender *</label>
                            <select id="Gender" name="Gender" required>
                                <option value="">Select Gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="Age">Age *</label>
                            <input type="number" id="Age" name="Age" min="10" max="100" required>
                            <span class="info-text">Your age in years</span>
                        </div>

                        <div class="form-group">
                            <label for="Height">Height (meters) *</label>
                            <input type="number" id="Height" name="Height" step="0.01" min="1.0" max="2.5" required>
                            <span class="info-text">Example: 1.75</span>
                        </div>

                        <div class="form-group">
                            <label for="Weight">Weight (kg) *</label>
                            <input type="number" id="Weight" name="Weight" step="0.1" min="30" max="200" required>
                            <span class="info-text">Your weight in kilograms</span>
                        </div>

                        <div class="form-group">
                            <label for="family_history_with_overweight">Family History of Overweight *</label>
                            <select id="family_history_with_overweight" name="family_history_with_overweight" required>
                                <option value="">Select</option>
                                <option value="yes">Yes</option>
                                <option value="no">No</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="FAVC">Frequent High Caloric Food *</label>
                            <select id="FAVC" name="FAVC" required>
                                <option value="">Select</option>
                                <option value="yes">Yes</option>
                                <option value="no">No</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="FCVC">Vegetable Consumption *</label>
                            <input type="number" id="FCVC" name="FCVC" step="0.1" min="1" max="3" required>
                            <span class="info-text">1=Never, 3=Always</span>
                        </div>

                        <div class="form-group">
                            <label for="NCP">Main Meals Per Day *</label>
                            <input type="number" id="NCP" name="NCP" step="0.1" min="1" max="4" required>
                            <span class="info-text">Number of main meals</span>
                        </div>

                        <div class="form-group">
                            <label for="CAEC">Food Between Meals *</label>
                            <select id="CAEC" name="CAEC" required>
                                <option value="">Select</option>
                                <option value="no">No</option>
                                <option value="Sometimes">Sometimes</option>
                                <option value="Frequently">Frequently</option>
                                <option value="Always">Always</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="SMOKE">Do You Smoke? *</label>
                            <select id="SMOKE" name="SMOKE" required>
                                <option value="">Select</option>
                                <option value="no">No</option>
                                <option value="yes">Yes</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="CH2O">Water Intake (Liters/Day) *</label>
                            <input type="number" id="CH2O" name="CH2O" step="0.1" min="0.5" max="5" required>
                            <span class="info-text">Daily water consumption (0.5-5L)</span>
                        </div>

                        <div class="form-group">
                            <label for="SCC">Calorie Monitoring *</label>
                            <select id="SCC" name="SCC" required>
                                <option value="">Select</option>
                                <option value="no">No</option>
                                <option value="yes">Yes</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="FAF">Physical Activity (Days/Week) *</label>
                            <input type="number" id="FAF" name="FAF" step="0.5" min="0" max="7" required>
                            <span class="info-text">0-7 days per week</span>
                        </div>

                        <div class="form-group">
                            <label for="TUE">Technology Use (Hours/Day) *</label>
                            <input type="number" id="TUE" name="TUE" step="0.5" min="0" max="12" required>
                            <span class="info-text">Screen time hours (0-12)</span>
                        </div>

                        <div class="form-group">
                            <label for="CALC">Alcohol Consumption *</label>
                            <select id="CALC" name="CALC" required>
                                <option value="">Select</option>
                                <option value="no">No</option>
                                <option value="Sometimes">Sometimes</option>
                                <option value="Frequently">Frequently</option>
                                <option value="Always">Always</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="MTRANS">Transportation Mode *</label>
                            <select id="MTRANS" name="MTRANS" required>
                                <option value="">Select</option>
                                <option value="Walking">Walking</option>
                                <option value="Bike">Bike</option>
                                <option value="Public_Transportation">Public Transportation</option>
                                <option value="Automobile">Automobile</option>
                                <option value="Motorbike">Motorbike</option>
                            </select>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary">🔍 Predict My Obesity Risk</button>
                </form>

                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p style="color: #667eea; font-weight: 600;">Analyzing your health data...</p>
                </div>

                <div class="result-section" id="resultSection">
                    <div class="result-header">
                        <div class="result-icon" id="resultIcon"></div>
                        <h2>Your Health Assessment</h2>
                        <div class="result-class" id="resultClass"></div>
                        <div class="result-confidence" id="resultConfidence"></div>
                        <div id="riskBadge" class="risk-badge"></div>
                    </div>

                    <button onclick="downloadReport()" class="btn btn-secondary">
                        📄 Download PDF Report
                    </button>

                    <div class="probability-bars" style="margin-top: 20px;">
                        <h3>📊 Probability Distribution</h3>
                        <div id="probabilityBars"></div>
                    </div>

                    <div class="recommendations-section">
                        <h3>💡 General Health Recommendations</h3>
                        <ul class="general-recommendations" id="generalRecommendations"></ul>
                    </div>

                    <div class="recommendations-section">
                        <h3>🎯 Personalized Recommendations Based on Your Data</h3>
                        <div id="personalizedRecommendations"></div>
                    </div>
                </div>
            </div>

            <!-- Batch Upload Tab -->
           <!-- Batch Upload Tab -->
<div id="batchTab" class="tab-content">
    <h2 style="margin-bottom: 25px; color: #333;">Batch Predictions from CSV</h2>
    
    <!-- Instructions Section -->
    <div class="recommendations-section" style="margin-bottom: 25px;">
        <h3>📋 Instructions</h3>
        <ol style="margin-left: 20px; line-height: 1.8;">
            <li>Download the CSV template below</li>
            <li>Fill in your data (one person per row)</li>
            <li>Save the file as CSV format</li>
            <li>Upload it using the area below</li>
            <li>Get predictions for all rows at once</li>
        </ol>
        
        <button onclick="downloadTemplate()" class="btn btn-secondary" style="margin-top: 15px; width: auto;">
            📥 Download CSV Template
        </button>
    </div>

    <!-- Required Columns Info -->
    <div style="background: #fff3cd; padding: 15px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #ffc107;">
        <strong>⚠️ Required Columns:</strong>
        <div style="margin-top: 10px; font-size: 0.9em; color: #666;">
            Gender, Age, Height, Weight, family_history_with_overweight, FAVC, FCVC, NCP, CAEC, SMOKE, CH2O, SCC, FAF, TUE, CALC, MTRANS
        </div>
    </div>
    
    <div class="upload-area" id="uploadArea" onclick="document.getElementById('csvFile').click()">
        <h3 style="color: #667eea;">📂 Click or Drag CSV File Here</h3>
        <p style="margin-top: 10px; color: #666;">Upload a CSV file with health data for multiple predictions</p>
        <p style="margin-top: 5px; color: #999; font-size: 0.9em;">Maximum file size: 10MB</p>
    </div>
    <input type="file" id="csvFile" accept=".csv" style="display:none" onchange="uploadCSV()">

    <div id="batchLoading" class="loading">
        <div class="spinner"></div>
        <p style="color: #667eea; font-weight: 600;">Processing batch predictions...</p>
    </div>

    <div id="batchResults" class="batch-results"></div>
</div>

            <!-- Statistics Tab -->
            <div id="statsTab" class="tab-content">
                <h2 style="margin-bottom: 25px; color: #333;">📈 System Statistics</h2>
                
                <div id="statsContent">
                    <p style="text-align: center; color: #666;">Loading statistics...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = window.location.hostname === 'localhost' 
    ? 'http://localhost:5000/api' 
    : 'https://YOUR_BACKEND_URL/api'; // You'll update this after backend deployment
        let currentFormData = null;

        // Load statistics on page load
        window.addEventListener('load', () => {
            loadStatistics();
        });

        function showTab(tabName) {
    // Hide all tabs
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
    });
    document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
    });

    // Show selected tab
    if (tabName === 'single') {
        document.getElementById('singleTab').classList.add('active');
        document.querySelector('[onclick="showTab(\'single\')"]').classList.add('active');
    } else if (tabName === 'batch') {
        document.getElementById('batchTab').classList.add('active');
        document.querySelector('[onclick="showTab(\'batch\')"]').classList.add('active');
    } else if (tabName === 'stats') {
        document.getElementById('statsTab').classList.add('active');
        document.querySelector('[onclick="showTab(\'stats\')"]').classList.add('active');
        loadDetailedStatistics();
    } else if (tabName === 'assistant') {
        document.getElementById('assistantTab').classList.add('active');
        document.querySelector('[onclick="showTab(\'assistant\')"]').classList.add('active');
        if (assistantState.step === 0) {
            setTimeout(() => startAssistant(), 300);
        }
    }
}

        async function loadStatistics() {
            try {
                const response = await fetch(`${API_URL}/stats`);
                const data = await response.json();
                
                if (data.success) {
                    const stats = data.statistics;
                    document.getElementById('totalPredictions').textContent = stats.total_predictions || '0';
                    document.getElementById('avgConfidence').textContent = stats.avg_confidence ? `${(stats.avg_confidence * 100).toFixed(1)}%` : '-';
                    document.getElementById('avgBMI').textContent = stats.avg_bmi || '-';
                }
            } catch (error) {
                console.log('Stats loading error:', error);
            }
        }

        async function loadDetailedStatistics() {
            try {
                const response = await fetch(`${API_URL}/stats`);
                const data = await response.json();
                
                if (data.success) {
                    const stats = data.statistics;
                    let html = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">';
                    
                    html += '<div class="recommendations-section"><h3>Predictions by Class</h3>';
                    if (Object.keys(stats.class_distribution).length > 0) {
                        html += '<ul class="general-recommendations">';
                        for (const [cls, count] of Object.entries(stats.class_distribution)) {
                            html += `<li>${cls.replace(/_/g, ' ')}: ${count}</li>`;
                        }
                        html += '</ul>';
                    } else {
                        html += '<p>No data yet</p>';
                    }
                    html += '</div></div>';
                    
                    document.getElementById('statsContent').innerHTML = html;
                }
            } catch (error) {
                document.getElementById('statsContent').innerHTML = '<p>Error loading statistics</p>';
            }
        }

        document.getElementById('predictionForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            document.getElementById('loading').style.display = 'block';
            document.getElementById('resultSection').style.display = 'none';
            
            const formData = new FormData(e.target);
            const data = {};
            
            formData.forEach((value, key) => {
                if (['Age', 'Height', 'Weight', 'FCVC', 'NCP', 'CH2O', 'FAF', 'TUE'].includes(key)) {
                    data[key] = parseFloat(value);
                } else {
                    data[key] = value;
                }
            });
            
            currentFormData = data;
            
            try {
                const response = await fetch(`${API_URL}/predict`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    displayResult(result);
                    loadStatistics();
                } else {
                    alert('Error: ' + result.error);
                }
            } catch (error) {
                alert('Backend not running! Start it first:\n1. Open terminal\n2. cd backend\n3. python app.py');
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        });

        function displayResult(result) {
            const { prediction, probabilities, recommendations } = result;
            
            document.getElementById('resultIcon').textContent = prediction.icon;
            document.getElementById('resultClass').textContent = prediction.status;
            document.getElementById('resultClass').style.color = prediction.color;
            
            const confidence = (prediction.confidence * 100).toFixed(1);
            document.getElementById('resultConfidence').textContent = `Confidence: ${confidence}%`;
            
            const riskBadge = document.getElementById('riskBadge');
            riskBadge.textContent = `Risk Level: ${prediction.risk_level}`;
            riskBadge.style.backgroundColor = prediction.color;
            
            const probBarsContainer = document.getElementById('probabilityBars');
            probBarsContainer.innerHTML = '';
            
            const sortedProbs = Object.entries(probabilities).sort((a, b) => b[1] - a[1]).slice(0, 5);
            
            sortedProbs.forEach(([className, prob]) => {
                const percentage = (prob * 100).toFixed(1);
                const displayName = className.replace(/_/g, ' ');
                
                const probItem = document.createElement('div');
                probItem.className = 'prob-item';
                probItem.innerHTML = `
                    <div class="prob-label">
                        <span>${displayName}</span>
                        <span>${percentage}%</span>
                    </div>
                    <div class="prob-bar">
                        <div class="prob-fill" style="width: ${percentage}%">${percentage > 10 ? percentage + '%' : ''}</div>
                    </div>
                `;
                probBarsContainer.appendChild(probItem);
            });
            
            const generalList = document.getElementById('generalRecommendations');
            generalList.innerHTML = '';
            recommendations.general.forEach(rec => {
                const li = document.createElement('li');
                li.textContent = rec;
                generalList.appendChild(li);
            });
            
            const personalizedContainer = document.getElementById('personalizedRecommendations');
            personalizedContainer.innerHTML = '';
            recommendations.personalized.forEach(rec => {
                const div = document.createElement('div');
                div.className = 'recommendation-category';
                div.innerHTML = `<div class="category-title">${rec.category}</div><div class="advice-text">${rec.advice}</div>`;
                personalizedContainer.appendChild(div);
            });
            
            document.getElementById('resultSection').style.display = 'block';
        }

        async function downloadReport() {
            if (!currentFormData) {
                alert('Make a prediction first!');
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/download_report`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(currentFormData)
                });
                
                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `health_report_${Date.now()}.pdf`;
                    a.click();
                    alert('PDF downloaded!');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function uploadCSV() {
    const fileInput = document.getElementById('csvFile');
    if (fileInput.files.length === 0) return;
    
    const file = fileInput.files[0];
    
    // Validate file size (10MB max)
    if (file.size > 10 * 1024 * 1024) {
        alert('File too large! Maximum size is 10MB');
        return;
    }
    
    const formData = new FormData();
    formData.append('file', file);

    document.getElementById('batchLoading').style.display = 'block';
    document.getElementById('batchResults').innerHTML = '';

    try {
        const response = await fetch(`${API_URL}/predict_batch_csv`, {
            method: 'POST',
            body: formData
        });
        
        const result = await response.json();
        
        if (result.success) {
            let html = `
                <div class="recommendations-section">
                    <h3>✓ Batch Processing Completed</h3>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 15px;">
                        <div style="text-align: center; padding: 15px; background: #e8f5e9; border-radius: 10px;">
                            <div style="font-size: 2em; color: #2ecc71; font-weight: bold;">${result.total_rows}</div>
                            <div style="color: #666;">Total Rows</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: #e3f2fd; border-radius: 10px;">
                            <div style="font-size: 2em; color: #2196F3; font-weight: bold;">${result.successful}</div>
                            <div style="color: #666;">Successful</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: #ffebee; border-radius: 10px;">
                            <div style="font-size: 2em; color: #f44336; font-weight: bold;">${result.failed}</div>
                            <div style="color: #666;">Failed</div>
                        </div>
                    </div>
                </div>
            `;
            
            // Show individual results
            html += '<div style="margin-top: 20px;"><h4>Individual Results:</h4>';
            result.results.forEach(item => {
                const icon = item.status === 'success' ? '✓' : '✗';
                const statusColor = item.status === 'success' ? '#2ecc71' : '#e74c3c';
                html += `
                    <div class="batch-result-item ${item.status}">
                        <div>
                            <span style="color: ${statusColor}; font-weight: bold; margin-right: 10px;">${icon}</span>
                            <strong>Row ${item.row}:</strong>
                            ${item.status === 'success' 
                                ? `${item.prediction} <span style="color: #666;">(${item.confidence})</span>`
                                : `<span style="color: #e74c3c;">${item.error}</span>`
                            }
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            
            document.getElementById('batchResults').innerHTML = html;
            loadStatistics(); // Refresh stats
            
        } else {
            alert('Error: ' + result.error);
        }
    } catch (error) {
        alert('Error uploading file: ' + error.message);
    } finally {
        document.getElementById('batchLoading').style.display = 'none';
        fileInput.value = ''; // Reset file input
    }
}
        function downloadTemplate() {
    // CSV template with all required columns and sample data
    const csvContent = `Gender,Age,Height,Weight,family_history_with_overweight,FAVC,FCVC,NCP,CAEC,SMOKE,CH2O,SCC,FAF,TUE,CALC,MTRANS
Male,23,1.75,89,no,yes,3,4,Sometimes,no,3,no,3,2,no,Automobile
Female,28,1.62,65,yes,no,2.5,3,Sometimes,no,2.5,yes,4,1,Sometimes,Walking
Male,45,1.80,105,yes,yes,1.5,3,Frequently,yes,1.8,no,1,3,Frequently,Automobile`;

    // Create blob and download
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const url = window.URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = 'obesity_prediction_template.csv';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    window.URL.revokeObjectURL(url);
    
    alert('✓ Template downloaded! Fill in your data and upload it.');
}

// AI Health Assistant - Enhanced Version
let assistantState = {
    step: 0,
    data: {},
    awaitingInput: false,
    lastResult: null
};

const conversationFlow = [
    {
        question: "Hi! I'm your AI Health Assistant. Let's start with the basics - what's your gender?",
        field: "Gender",
        type: "choice",
        options: ["Male", "Female"],
        validation: (val) => ["male", "female"].includes(val.toLowerCase()),
        process: (val) => val.charAt(0).toUpperCase() + val.slice(1).toLowerCase()
    },
    {
        question: "Great! How old are you?",
        field: "Age",
        type: "number",
        validation: (val) => !isNaN(val) && val >= 10 && val <= 100,
        feedback: (val) => val < 18 ? "You're quite young! Let's make sure we help you develop healthy habits." : 
                           val > 60 ? "It's never too late to focus on health!" : "Perfect, let's continue!"
    },
    {
        question: "What's your height in meters? (For example: 1.75)",
        field: "Height",
        type: "number",
        validation: (val) => !isNaN(val) && val >= 1.0 && val <= 2.5,
        feedback: (val) => "Got it! " + val + " meters tall."
    },
    {
        question: "And your weight in kilograms?",
        field: "Weight",
        type: "number",
        validation: (val) => !isNaN(val) && val >= 30 && val <= 300,
        feedback: (val, data) => {
            const bmi = val / (data.Height ** 2);
            return `Thanks! Your BMI is approximately ${bmi.toFixed(1)}. Let's continue to get a complete picture.`;
        }
    },
    {
        question: "Does anyone in your family have a history of being overweight?",
        field: "family_history_with_overweight",
        type: "choice",
        options: ["Yes", "No"],
        validation: (val) => ["yes", "no"].includes(val.toLowerCase()),
        process: (val) => val.toLowerCase()
    },
    {
        question: "Do you frequently eat high caloric food?",
        field: "FAVC",
        type: "choice",
        options: ["Yes", "No"],
        validation: (val) => ["yes", "no"].includes(val.toLowerCase()),
        process: (val) => val.toLowerCase(),
        feedback: (val) => val.toLowerCase() === "yes" ? "That's important to know. We'll factor that in." : "Good to hear!"
    },
    {
        question: "How often do you eat vegetables? (Rate from 1-3, where 1=rarely, 3=always)",
        field: "FCVC",
        type: "number",
        validation: (val) => !isNaN(val) && val >= 1 && val <= 3,
        feedback: (val) => val < 2 ? "Try to increase your vegetable intake! It's really beneficial." : "Great vegetable intake!"
    },
    {
        question: "How many main meals do you have per day? (1-4)",
        field: "NCP",
        type: "number",
        validation: (val) => !isNaN(val) && val >= 1 && val <= 4,
        feedback: (val) => val >= 3 ? "Good meal frequency!" : "Consider having at least 3 meals daily."
    },
    {
        question: "Do you eat food between meals?",
        field: "CAEC",
        type: "choice",
        options: ["No", "Sometimes", "Frequently", "Always"],
        validation: (val) => ["no", "sometimes", "frequently", "always"].includes(val.toLowerCase()),
        process: (val) => val.charAt(0).toUpperCase() + val.slice(1).toLowerCase()
    },
    {
        question: "Do you smoke?",
        field: "SMOKE",
        type: "choice",
        options: ["Yes", "No"],
        validation: (val) => ["yes", "no"].includes(val.toLowerCase()),
        process: (val) => val.toLowerCase(),
        feedback: (val) => val.toLowerCase() === "yes" ? "Smoking significantly impacts health. Consider quitting programs!" : ""
    },
    {
        question: "How much water do you drink daily in liters? (0.5 to 5)",
        field: "CH2O",
        type: "number",
        validation: (val) => !isNaN(val) && val >= 0.5 && val <= 5,
        feedback: (val) => val < 2 ? "Try to drink at least 2 liters daily!" : "Excellent hydration!"
    },
    {
        question: "Do you monitor your calorie intake?",
        field: "SCC",
        type: "choice",
        options: ["Yes", "No"],
        validation: (val) => ["yes", "no"].includes(val.toLowerCase()),
        process: (val) => val.toLowerCase()
    },
    {
        question: "How many days per week do you do physical activity? (0-7)",
        field: "FAF",
        type: "number",
        validation: (val) => !isNaN(val) && val >= 0 && val <= 7,
        feedback: (val) => val < 3 ? "Try to increase physical activity to at least 3-5 days!" : val >= 5 ? "Great activity level!" : "Good start!"
    },
    {
        question: "How many hours per day do you use technology devices? (0-12)",
        field: "TUE",
        type: "number",
        validation: (val) => !isNaN(val) && val >= 0 && val <= 12,
        feedback: (val) => val > 6 ? "That's quite a lot of screen time! Consider reducing it." : ""
    },
    {
        question: "How often do you drink alcohol?",
        field: "CALC",
        type: "choice",
        options: ["No", "Sometimes", "Frequently", "Always"],
        validation: (val) => ["no", "sometimes", "frequently", "always"].includes(val.toLowerCase()),
        process: (val) => val.charAt(0).toUpperCase() + val.slice(1).toLowerCase()
    },
    {
        question: "What's your primary mode of transportation?",
        field: "MTRANS",
        type: "choice",
        options: ["Walking", "Bike", "Public Transportation", "Automobile", "Motorbike"],
        validation: (val) => {
            const normalized = val.toLowerCase().replace(/\s+/g, '_');
            return ["walking", "bike", "public_transportation", "public transportation", "automobile", "car", "motorbike"].includes(normalized);
        },
        process: (val) => {
            const normalized = val.toLowerCase().replace(/\s+/g, '_');
            const map = {
                'walking': 'Walking',
                'bike': 'Bike',
                'public_transportation': 'Public_Transportation',
                'public transportation': 'Public_Transportation',
                'automobile': 'Automobile',
                'car': 'Automobile',
                'motorbike': 'Motorbike'
            };
            return map[normalized] || val;
        },
        feedback: (val) => {
            const active = ["Walking", "Bike"].includes(val);
            return active ? "Active transportation - excellent choice for health!" : "";
        }
    }
];

function addMessage(text, isUser = false) {
    const messagesDiv = document.getElementById('chatMessages');
    const messageDiv = document.createElement('div');
    messageDiv.className = `chat-message ${isUser ? 'user' : 'assistant'}`;
    messageDiv.innerHTML = text.replace(/\n/g, '<br>');
    messagesDiv.appendChild(messageDiv);
    
    const container = document.getElementById('chatContainer');
    setTimeout(() => {
        container.scrollTop = container.scrollHeight;
    }, 100);
}

function updateProgressBar() {
    let progressDiv = document.getElementById('progressBar');
    if (!progressDiv) {
        progressDiv = document.createElement('div');
        progressDiv.id = 'progressBar';
        progressDiv.className = 'progress-indicator';
        progressDiv.innerHTML = '<div class="progress-bar"></div>';
        document.getElementById('chatMessages').insertBefore(progressDiv, document.getElementById('chatMessages').firstChild);
    }
    
    const progress = (assistantState.step / conversationFlow.length) * 100;
    progressDiv.querySelector('.progress-bar').style.width = progress + '%';
}

function showTypingIndicator() {
    const messagesDiv = document.getElementById('chatMessages');
    const typingDiv = document.createElement('div');
    typingDiv.id = 'typingIndicator';
    typingDiv.className = 'typing-indicator';
    typingDiv.innerHTML = '<span></span><span></span><span></span>';
    messagesDiv.appendChild(typingDiv);
    
    const container = document.getElementById('chatContainer');
    setTimeout(() => {
        container.scrollTop = container.scrollHeight;
    }, 100);
}

function removeTypingIndicator() {
    const indicator = document.getElementById('typingIndicator');
    if (indicator) indicator.remove();
}

function showQuickReplies(options) {
    const messagesDiv = document.getElementById('chatMessages');
    const repliesDiv = document.createElement('div');
    repliesDiv.id = 'quickReplies';
    repliesDiv.style.margin = '10px 0';
    
    options.forEach(option => {
        const btn = document.createElement('button');
        btn.className = 'quick-reply-btn';
        btn.textContent = option;
        btn.onclick = () => {
            document.getElementById('userInput').value = option;
            sendMessage();
        };
        repliesDiv.appendChild(btn);
    });
    
    messagesDiv.appendChild(repliesDiv);
    
    const container = document.getElementById('chatContainer');
    setTimeout(() => {
        container.scrollTop = container.scrollHeight;
    }, 100);
}

function startAssistant() {
    assistantState = {
        step: 0,
        data: {},
        awaitingInput: false,
        lastResult: null
    };
    
    document.getElementById('chatMessages').innerHTML = '';
    document.getElementById('userInput').value = '';
    document.getElementById('assistantDetailedResults').style.display = 'none';
    
    setTimeout(() => {
        askNextQuestion();
    }, 500);
}

function askNextQuestion() {
    if (assistantState.step >= conversationFlow.length) {
        finishAssessment();
        return;
    }
    
    updateProgressBar();
    const current = conversationFlow[assistantState.step];
    
    showTypingIndicator();
    setTimeout(() => {
        removeTypingIndicator();
        addMessage(current.question);
        
        if (current.type === 'choice' && current.options) {
            showQuickReplies(current.options);
        }
        
        assistantState.awaitingInput = true;
        document.getElementById('userInput').focus();
    }, 1200);
}

async function sendMessage() {
    const input = document.getElementById('userInput');
    const userMessage = input.value.trim();
    
    if (!userMessage || !assistantState.awaitingInput) return;
    
    const quickReplies = document.getElementById('quickReplies');
    if (quickReplies) quickReplies.remove();
    
    addMessage(userMessage, true);
    input.value = '';
    assistantState.awaitingInput = false;
    
    const current = conversationFlow[assistantState.step];
    
    // Validate
    if (!current.validation(userMessage)) {
        showTypingIndicator();
        setTimeout(() => {
            removeTypingIndicator();
            addMessage("Hmm, that doesn't seem right. " + current.question);
            if (current.options) {
                showQuickReplies(current.options);
            }
            assistantState.awaitingInput = true;
        }, 1000);
        return;
    }
    
    // Process and store
    const processedValue = current.process ? current.process(userMessage) : userMessage;
    assistantState.data[current.field] = current.type === 'number' ? parseFloat(processedValue) : processedValue;
    
    // Feedback
    if (current.feedback) {
        const feedbackText = typeof current.feedback === 'function' 
            ? current.feedback(processedValue, assistantState.data) 
            : current.feedback;
        
        if (feedbackText) {
            showTypingIndicator();
            setTimeout(() => {
                removeTypingIndicator();
                addMessage(feedbackText);
                
                setTimeout(() => {
                    assistantState.step++;
                    askNextQuestion();
                }, 1200);
            }, 1000);
            return;
        }
    }
    
    // Move to next
    showTypingIndicator();
    setTimeout(() => {
        removeTypingIndicator();
        assistantState.step++;
        askNextQuestion();
    }, 800);
}

async function finishAssessment() {
    showTypingIndicator();
    setTimeout(async () => {
        removeTypingIndicator();
        addMessage("Perfect! I have all the information I need. Let me analyze your health data... This will take just a moment.");
        
        showTypingIndicator();
        
        try {
            const response = await fetch(`${API_URL}/predict`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(assistantState.data)
            });
            
            const result = await response.json();
            
            removeTypingIndicator();
            
            if (result.success) {
                assistantState.lastResult = result;
                const pred = result.prediction;
                const confidence = (pred.confidence * 100).toFixed(1);
                
                setTimeout(() => {
                    addMessage(
                        `<strong>📊 Analysis Complete!</strong><br><br>` +
                        `<strong>Classification:</strong> ${pred.status}<br>` +
                        `<strong>Risk Level:</strong> ${pred.risk_level}<br>` +
                        `<strong>Confidence:</strong> ${confidence}%<br><br>` +
                        `Would you like to see detailed results with personalized recommendations?`
                    );
                    
                    const messagesDiv = document.getElementById('chatMessages');
                    const actionsDiv = document.createElement('div');
                    actionsDiv.style.margin = '15px 0';
                    actionsDiv.innerHTML = `
                        <button onclick="showDetailedResultsInChat()" class="btn btn-primary" style="width: auto; margin: 5px; padding: 12px 25px; border-radius: 10px;">
                            📊 View Detailed Results
                        </button>
                        <button onclick="downloadReportFromAssistant()" class="btn btn-secondary" style="width: auto; margin: 5px; padding: 12px 25px; border-radius: 10px;">
                            📄 Download PDF Report
                        </button>
                    `;
                    messagesDiv.appendChild(actionsDiv);
                    
                    currentFormData = assistantState.data;
                    loadStatistics();
                    
                    const container = document.getElementById('chatContainer');
                    setTimeout(() => {
                        container.scrollTop = container.scrollHeight;
                    }, 100);
                }, 1800);
            }
        } catch (error) {
            removeTypingIndicator();
            addMessage("Sorry, I encountered an error analyzing your data. Please make sure the backend is running and try again.");
        }
    }, 1000);
}

function showDetailedResultsInChat() {
    if (!assistantState.lastResult) return;
    
    const result = assistantState.lastResult;
    const pred = result.prediction;
    const confidence = (pred.confidence * 100).toFixed(1);
    
    addMessage("Here's your comprehensive health analysis:");
    
    const detailsDiv = document.getElementById('assistantDetailedResults');
    detailsDiv.style.display = 'block';
    
    // Create comprehensive results
    let html = `
        <div class="result-card-chat">
            <h4>🎯 Your Classification</h4>
            <div style="font-size: 1.3em; color: ${pred.color}; font-weight: bold; margin: 10px 0;">
                ${pred.icon} ${pred.status}
            </div>
            <div style="background: ${pred.color}; color: white; display: inline-block; padding: 5px 15px; border-radius: 20px; font-size: 0.9em; margin: 5px 0;">
                Risk Level: ${pred.risk_level}
            </div>
        </div>

        <div class="result-card-chat">
            <h4>📊 Confidence Score</h4>
            <div class="confidence-bar-chat">
                <div class="confidence-fill-chat" style="width: ${confidence}%">
                    ${confidence}%
                </div>
            </div>
        </div>

        <div class="result-card-chat">
            <h4>📈 Probability Distribution (Top 5)</h4>
    `;
    
    const sortedProbs = result.top_predictions.slice(0, 5);
    sortedProbs.forEach(item => {
        const percentage = (item.probability * 100).toFixed(1);
        html += `
            <div style="margin: 10px 0;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                    <span style="font-weight: 600;">${item.class.replace(/_/g, ' ')}</span>
                    <span style="color: #667eea; font-weight: bold;">${percentage}%</span>
                </div>
                <div style="background: #e0e0e0; height: 8px; border-radius: 10px; overflow: hidden;">
                    <div style="background: linear-gradient(90deg, #667eea, #764ba2); height: 100%; width: ${percentage}%; transition: width 1s;"></div>
                </div>
            </div>
        `;
    });
    html += `</div>`;

    // General Recommendations
    html += `
        <div class="result-card-chat">
            <h4>💡 General Health Recommendations</h4>
            <ul style="margin: 10px 0; padding-left: 20px; line-height: 1.8;">
    `;
    result.recommendations.general.forEach(rec => {
        html += `<li style="margin: 8px 0;">${rec}</li>`;
    });
    html += `</ul></div>`;

    // Personalized Recommendations
    html += `
        <div class="result-card-chat">
            <h4>🎯 Personalized Recommendations</h4>
    `;
    result.recommendations.personalized.forEach(rec => {
        html += `
            <div style="margin: 15px 0; padding: 12px; background: #f8f9fa; border-left: 4px solid #667eea; border-radius: 5px;">
                <div style="font-weight: 700; color: #667eea; margin-bottom: 5px;">${rec.category}</div>
                <div style="color: #555;">${rec.advice}</div>
            </div>
        `;
    });
    html += `</div>`;
    
    detailsDiv.innerHTML = html;
    
    // Scroll to results
    setTimeout(() => {
        detailsDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }, 300);
}

async function downloadReportFromAssistant() {
    if (!currentFormData) {
        addMessage("Please complete the assessment first!");
        return;
    }
    
    addMessage("Generating your PDF report... Please wait.");
    await downloadReport();
}

function skipToForm() {
    showTab('single');
}   </script>
</body>

</html>
